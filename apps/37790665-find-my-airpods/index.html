<!DOCTYPE html>
<html><head><link rel="manifest" href="/apps/37790665-find-my-airpods/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="description" content="A gcode developed PWA app"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta property="fpwa:template" content="pwa=true,name=airpods,short_name=airpods,theme_color=#ffffff,background_color=#ffffff,display=standalone,orientation=any"><link rel="apple-touch-icon" href="/apps/37790665-find-my-airpods/icon.png"><link rel="apple-touch-icon-precomposed" href="/apps/37790665-find-my-airpods/icon.png"><link rel="icon" href="/apps/37790665-find-my-airpods/icon.png"><style>
.splash{position:absolute;background-size:200px;background-image:url('splash.icon.png');background-position:center;background-repeat:no-repeat;top:0px;bottom:0px;left:0px;right:0px;color:#0F0F0F;background-color:#ffffff;}
.loader{font-size:50px;text-indent:-9999em;overflow:hidden;width:1em;height:1em;border-radius:50%;margin:72px auto;position:absolute;bottom:20px;left:20px;right:20px;bottom:0;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:load6 1.7s infinite ease,round 1.7s infinite ease;animation:load6 1.7s infinite ease,round 1.7s infinite ease}@-webkit-keyframes load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}100%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}}@keyframes load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}100%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}}@-webkit-keyframes round{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes round{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}
</style><script>
  window.PWA={globals:{}};
  window.PWA.globals.appName="airpods";
  window.PWA.globals.orientation="any";
  window.PWA.globals.icon="icon.png";
  window.PWA.globals.icon180x180="180x180.icon.png";
  window.PWA.globals.icon192x192="192x192.icon.png";
  window.PWA.globals.icon512x512="512x512.icon.png";
  window.PWA.globals.splash="splash.png";
  window.PWA.globals.splashColor="#0F0F0F";
  window.PWA.globals.splashBackgroundColor="#ffffff";
  window.PWA.globals.splashDuration=20;

let deferredPrompt;
if('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/apps/37790665-find-my-airpods/sw.js');
};

function addToHomeScreen() {
   let a2hsBtn = document.querySelector(".ad2hs-prompt");
   a2hsBtn.style.display = 'none'; 
   deferredPrompt.prompt();
   deferredPrompt.userChoice.then(function(choiceResult){
   if (choiceResult.outcome === 'accepted') console.log('User accepted the A2HS prompt');
   else console.log('User dismissed the A2HS prompt');
   deferredPrompt = null;
 });}
function showAddToHomeScreen() {
   let a2hsBtn = document.querySelector(".ad2hs-prompt");
   if(a2hsBtn)a2hsBtn.style.display ="block";
   if(a2hsBtn)a2hsBtn.addEventListener("click", addToHomeScreen);
 }
 window.addEventListener('beforeinstallprompt', function (e) {
   e.preventDefault();
   deferredPrompt = e;
   showAddToHomeScreen();
   setTimeout(()=>{
    let ad2hs=document.querySelector(".ad2hs-prompt");
    if(ad2hs) ad2hs.style.display ="none";
},10000);
 });
function showIosInstall() {
  let iosPrompt = document.querySelector(".ios-prompt");
  if(iosPrompt)iosPrompt.style.display = "block";
  if(iosPrompt)iosPrompt.addEventListener("click", () => {
  if(iosPrompt)iosPrompt.style.display = "none";
  });
}

const isIos = () => {
  const userAgent = window.navigator.userAgent.toLowerCase();
  return /iphone|ipad|ipod/.test( userAgent );
}
const isInStandaloneMode = () => ('standalone' in window.navigator) && (window.navigator.standalone);
document.addEventListener("DOMContentLoaded", ()=>{
   console.log("DOMContentLoaded");
   if (isIos() && !isInStandaloneMode()) {
  showIosInstall();
   console.log("showIosInstall");
  }
});

</script><script type="module">
import { addkey } from "https://gcode.com.au/modules/near/index.mjs";

if (window.opener && window.opener !== window) {
    window.addEventListener("message",function(e){if(e.origin=="https://gcode.com.au")addkey(e.data);},false);
    window.addEventListener("load", (event) => {window.opener.postMessage("loaded","https://gcode.com.au");});
}

</script><script type="module">
/*

  filename:git://gormantec:gcode_repo/find-my-airpodsj.mjs
  created: 2024-2-4T14:34:38
  appName: find-my-airpods
  splashSize: 200px
  splash: git://gormantec:gcode_repo/applegrey.png.svg
  splashBackgroundColor: #ffffff
  splashDuration: 20

*/

/*---------------------------------------------------------------------------*/
import { PWA, Page, Div } from 'https://gcode.com.au/modules/pwa.mjs';
import {gps} from './lib/gps.lib.mjs';
try { Page.clearPages(); } catch (e) {}
/*----------------------------------------------*/
// This works on all devices/browsers, and uses IndexedDBShim as a final fallback 

var aPWA = new PWA({
    "title": "find my air pods",
    "primaryColor": "#aaaaaa",
    "hideHeader": "true",
});
aPWA.alertDialogContent.element.style.backgroundColor = "#eeeeee";
aPWA.alertDialogBody.element.style.height = "100px";
aPWA.alertDialogBody.element.style.marginTop = "200px";
let lastCoords = null;
const options = {
    enableHighAccuracy: true,
    timeout: 5000,
    maximumAge: 8000,
};
const errorLog = function(err) {
    console.warn("ERROR(" + err.code + ": " + err.message + ")")
}
let _position = {
    coords: {
        latitude: 0,
        longitude: 0
    }
};
let leftLight = new Div({
    "backgroundColor": "#FFA500",
    id: "leftButton",
    height: "10px",
    width: "10px",
    left: "110px",
    top: "120px",
    borderRadius: "40px"
});

let rightLight = new Div({
    "backgroundColor": "#FFA500",
    id: "leftButton",
    height: "10px",
    width: "10px",
    right: "110px",
    top: "120px",
    borderRadius: "40px"
});

let locationTextDiv = new Div({
    id: "locationText",
    textAlign: "center",
    "color": "#aaaaaa",
    height: "40px",
    left: "100px",
    right: "100px",
    top: "240px",
    onclick: function() {
        aPWA.setPage("SecondPage");
    }
});
let hook = null;
let flashFunction = async function() {
    let count = 0;

    console.log("!********************************************");


    let action = function(name) {
        return (resolve, reject) => {
            let timeOut = setTimeout(() => {
                console.log("timeout");
                resolve();
            }, 5000);
            navigator.permissions.query({
                name: "" + name
            }).then((result) => {
                clearTimeout(timeOut);
                aPWA.alert("" + name + ":" + result.state);
                aPWA.addEventListener("alertDialogClosed", () => {
                    console.log("alertDialogClosed");
                    resolve();
                }, {
                    once: true
                });
            }).catch((e) => {
                clearTimeout(timeOut);
                resolve();
            });
        }
    }
    //console.log("get geolocation");
    //await new Promise(action("geolocation"));
    //console.log("get gyroscope");
    //await new Promise(action("gyroscope"));
    //console.log("get microphone");
    //await new Promise(action("microphone"));
    // await new Promise(action("notifications"));
    //await new Promise(action("background-sync"));
    //await new Promise(action("accelerometer"));

    console.log("!!!!!!!!!!!!");

    hook = setInterval(function() {
        if (leftLight.element.style.backgroundColor == "rgb(255, 165, 0)") {
            leftLight.element.style.backgroundColor = "#aaaaaa";
            rightLight.element.style.backgroundColor = "#aaaaaa";
        } else if (count == Math.round(count / 12, 0) * 12) {
            leftLight.element.style.backgroundColor = "rgb(255, 165, 0)";
            rightLight.element.style.backgroundColor = "rgb(255, 165, 0)";
        }
        count++;

    }, 200);
}

let foundAirPods = false;
let searchAirPods = async function() {

    console.log("searchAirPods");
    foundAirPods = false;
    //let xxx = await navigator.mediaDevices.getUserMedia({
    //    audio: true
    //});
    //const tracks = xxx.getAudioTracks();
    //console.log(xxx);
    //console.log(tracks);
    if (!navigator.mediaDevices?.enumerateDevices) {
        console.log("enumerateDevices() not supported.");
    } else {
        // List cameras and microphones.
        let founsAirPod = false;
        navigator.mediaDevices
            .enumerateDevices()
            .then((devices) => {
                devices.forEach((device) => {
                    //console.log("device:" + JSON.stringify(device));
                    if (device.label == "AirPods" && (device.kind == "audioinput" || device.kind == "audiooutput")) {
                      console.log("foundAirpods");
                        if (navigator.geolocation) {
                            navigator.geolocation.getCurrentPosition((position) => {
                              console.log("foundAirpods2");
                                _position = position;
                                foundAirPods = true;
                                setTimeout(() => {
                                    if (hook != null) clearInterval(hook);
                                    hook = null;
                                    setTimeout(() => {
                                        leftLight.element.style.backgroundColor = "rgb(0, 255, 0)";
                                        rightLight.element.style.backgroundColor = "rgb(0, 255, 0)";
                                    }, 100)
                                }, 100);
                                //aPWA.alert("AirPods connected at " + Math.round(_position.coords.latitude * 1000) / 1000 + "x" + Math.round(_position.coords.longitude * 1000) / 1000);
                                let locationText = "" + Math.round(_position.coords.latitude * 10000) / 10000 + ", " + Math.round(_position.coords.longitude * 10000) / 10000;
                                window.localStorage.setItem("lastLocation", locationText);
                                window.localStorage.setItem("lastCoords", JSON.stringify({
                                    timestamp: _position.timestamp,
                                    coords: {latitude:_position.coords.latitude,longitude:_position.coords.longitude}
                                }));

                            }, errorLog, options);
                        } else {
                            console.log("no navigator.geolocation");
                        }
                    }
                });
                if (founsAirPod == false && hook == null) {
                    flashFunction();
                }
            })
            .catch((err) => {
                console.error(`${err.name}: ${err.message}`);
            })
      .finally(()=>{
        let locationText = window.localStorage.getItem("lastLocation");
        locationTextDiv.element.innerText = locationText;
        setTimeout(() => {
            if (!foundAirPods) searchAirPods();
            else {
                setTimeout(() => {
                    searchAirPods();
                }, 10000);
            }
        }, 5000);
        });
    }
    lastCoords = window.localStorage.getItem("lastCoords");
    if (lastCoords) lastCoords = JSON.parse(lastCoords);
    if (locationText) locationTextDiv.element.innerText = locationText;
    if (lastCoords) {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((position) => {
                _position = position;
                if (lastCoords && Math.round(lastCoords.coords.latitude * 5000) == Math.round(_position.coords.latitude * 5000) && Math.round(lastCoords.coords.longitude * 5000) == Math.round(_position.coords.longitude * 5000)) {
                    locationTextDiv.element.style.color = "rgb(0,255,0)";
                  console.log("SAME");
                } else {
                    locationTextDiv.element.style.color = "rgb(255,0,0)";
                  console.log("NOT SAME");
                }
                console.log("lastCoords:" + JSON.stringify(lastCoords));
            });
        }
    }
};
setTimeout(searchAirPods, 5000);
let locationText = window.localStorage.getItem("lastLocation");
if(locationText)locationTextDiv.element.innerText = locationText;






class HomePage extends Page {
    constructor() {
        super({
            "color": "#ffffff",
            "backgroundColor": "#ffffff",
            "backgroundPosition": "center",
            "backgroundSize": "60%",
            "backgroundRepeat": "no-repeat",
            "backgroundImage": "url(https://logo.com/image-cdn/images/kts928pd/production/9fa92ac5a9498502d2707ced798d763fe7490ecc-1600x1026.png?w=1080&q=72)",
            "hideHeader": "true",
            "hideFooter": "true",
            "hideFloatingActionButton": "true",
            "onOpen": flashFunction,
            "children": [
                new Div({
                    "color": "#ffffff",
                    height: "50px",
                    width: "50px",
                    left: "100px",
                    top: "100px",
                    borderRadius: "40px",
                    borderColor: "#aaaaaa",
                    borderStyle: "solid",
                    borderThickness: "1px"
                }),
                new Div({
                    "color": "#ffffff",
                    height: "50px",
                    width: "50px",
                    right: "100px",
                    top: "100px",
                    borderRadius: "40px",
                    borderColor: "#aaaaaa",
                    borderStyle: "solid",
                    borderThickness: "1px"
                }),
                new Div({
                    "color": "#ffffff",
                    height: "29px",
                    width: "10px",
                    left: "94px",
                    top: "112px",
                    backgroundColor: "#ffffff",
                    borderColor: "#aaaaaa",
                    borderRightStyle: "solid",
                    borderThickness: "1px"
                }),
                new Div({
                    "color": "#ffffff",
                    height: "29px",
                    width: "10px",
                    right: "94px",
                    top: "112px",
                    backgroundColor: "#ffffff",
                    borderColor: "#aaaaaa",
                    borderLeftStyle: "solid",
                    borderThickness: "1px"
                }),

                new Div({
                    "color": "#ffffff",
                    height: "100px",
                    width: "15px",
                    left: "135px",
                    top: "116px",
                    backgroundColor: "#ffffff",
                    borderColor: "#aaaaaa",
                    borderStyle: "solid",
                    borderThickness: "1px",
                    borderRadius: "8px",
                }),

                new Div({
                    "color": "#ffffff",
                    height: "100px",
                    width: "15px",
                    right: "135px",
                    top: "116px",
                    backgroundColor: "#ffffff",
                    borderColor: "#aaaaaa",
                    borderStyle: "solid",
                    borderThickness: "1px",
                    borderRadius: "8px",
                }),
                new Div({
                    "color": "#ffffff",
                    height: "30px",
                    width: "24px",
                    left: "127px",
                    top: "114px",
                    backgroundColor: "#ffffff",
                    borderRadius: "6px",
                }),
                new Div({
                    "color": "#ffffff",
                    height: "30px",
                    width: "24px",
                    right: "127px",
                    top: "114px",
                    backgroundColor: "#ffffff",
                    borderRadius: "6px",
                }),
                leftLight,
                rightLight,
                new Div({
                    innerText: "L",
                    textAlign: "center",
                    "color": "#aaaaaa",
                    height: "40px",
                    width: "40px",
                    left: "100px",
                    top: "180px"
                }),
                new Div({
                    innerText: "R",
                    textAlign: "center",
                    "color": "#aaaaaa",
                    height: "40px",
                    width: "40px",
                    right: "100px",
                    top: "180px"
                }),
                locationTextDiv,
            ]
        });
    }

}

class SecondPage extends Page {
    constructor() {
        super({
            "color": "#ffffff",
            "backgroundColor": "#ffffff",
            "hideFooter": "true",
            "hideFloatingActionButton": "true",
            "children": [

                gps.newImageDiv({
                    fontSize: "30px",
                    "top": "0px",
                    "left": "0px",
                    "width": "100%",
                    "height": window.innerHeight + "px",
                    backgroundColor: "#555555",
                }),
                gps.newCoordDiv({
                    textAlign: "center",
                    padding: "4px",
                    fontSize: "20px",
                    "marginTop": "20px",
                    "position": "relative",
                    "width": "260px",
                    "marginLeft": "auto",
                    "marginRight": "auto",
                    backgroundColor: "#ffffff",
                    borderRadius: "15px",
                    color: "#aaaaaa",
                    innerText: "0"
                }),
                new Div({
                    innerText: "BACK",
                    textAlign: "center",
                    padding: "5px",
                    fontSize: "20px",
                    bottom: "20px",
                    left: "0px",
                    right: "0px",
                    "width": "100px",
                    "height": "20px",
                    "borderRadius": "10px",
                    "marginLeft": "auto",
                    "marginRight": "auto",
                    backgroundColor: "#ffffff",
                    color: "#aaaaaa",
                    onclick: function() {
                        aPWA.setPage("HomePage");
                    }
                })
            ],
            onOpen: function() {
                gps.updateLocation();
            }
        });
    }
}
/*---------------------------------------------------------------------------*/
var myDiv = new Div({
    innerHTML: "url(https://gcode.com.au/html/test.html)"
});
var aHomePage = new HomePage();
var aSecondPage = new SecondPage();

aPWA.setPage(aHomePage);
aPWA.hideHeader();
aPWA.show();
/*---------------------------------------------------------------------------*/
</script></head><body><div class="splash"></div><div class="loader">Loading...</div></body></html>