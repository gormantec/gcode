<!DOCTYPE html>
<html><head><link rel="manifest" href="/apps/37790665-findmyapple/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="description" content="A gcode developed PWA app"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta property="fpwa:template" content="pwa=true,name=findmyapple,short_name=findmyapple,theme_color=#212121,background_color=#212121,display=standalone,orientation=any"><link rel="apple-touch-icon" href="/apps/37790665-findmyapple/icon.png"><link rel="apple-touch-icon-precomposed" href="/apps/37790665-findmyapple/icon.png"><link rel="icon" href="/apps/37790665-findmyapple/icon.png"><style>
.splash{position:absolute;background-size:200px;background-image:url('splash.icon.png');background-position:center;background-repeat:no-repeat;top:0px;bottom:0px;left:0px;right:0px;color:#F0F0F0;background-color:#212121;}
.loader{font-size:50px;text-indent:-9999em;overflow:hidden;width:1em;height:1em;border-radius:50%;margin:72px auto;position:absolute;bottom:20px;left:20px;right:20px;bottom:0;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:load6 1.7s infinite ease,round 1.7s infinite ease;animation:load6 1.7s infinite ease,round 1.7s infinite ease}@-webkit-keyframes load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}100%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}}@keyframes load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}100%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}}@-webkit-keyframes round{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes round{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}
</style><script>
  window.PWA={globals:{}};
  window.PWA.globals.appName="findmyapple";
  window.PWA.globals.orientation="any";
  window.PWA.globals.icon="icon.png";
  window.PWA.globals.icon180x180="180x180.icon.png";
  window.PWA.globals.icon192x192="192x192.icon.png";
  window.PWA.globals.icon512x512="512x512.icon.png";
  window.PWA.globals.splash="splash.png";
  window.PWA.globals.splashColor="#F0F0F0";
  window.PWA.globals.mockFrame="iphoneX";
  window.PWA.globals.splashBackgroundColor="#212121";
  window.PWA.globals.splashDuration=2000;

let deferredPrompt;
if('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/apps/37790665-findmyapple/sw.js');
};

function addToHomeScreen() {
   let a2hsBtn = document.querySelector(".ad2hs-prompt");
   a2hsBtn.style.display = 'none'; 
   deferredPrompt.prompt();
   deferredPrompt.userChoice.then(function(choiceResult){
   if (choiceResult.outcome === 'accepted') console.log('User accepted the A2HS prompt');
   else console.log('User dismissed the A2HS prompt');
   deferredPrompt = null;
 });}
function showAddToHomeScreen() {
   let a2hsBtn = document.querySelector(".ad2hs-prompt");
   if(a2hsBtn)a2hsBtn.style.display ="block";
   if(a2hsBtn)a2hsBtn.addEventListener("click", addToHomeScreen);
 }
 window.addEventListener('beforeinstallprompt', function (e) {
   e.preventDefault();
   deferredPrompt = e;
   showAddToHomeScreen();
   setTimeout(()=>{
    let ad2hs=document.querySelector(".ad2hs-prompt");
    if(ad2hs) ad2hs.style.display ="none";
},10000);
 });
function showIosInstall() {
  let iosPrompt = document.querySelector(".ios-prompt");
  if(iosPrompt)iosPrompt.style.display = "block";
  if(iosPrompt)iosPrompt.addEventListener("click", () => {
  if(iosPrompt)iosPrompt.style.display = "none";
  });
}

const isIos = () => {
  const userAgent = window.navigator.userAgent.toLowerCase();
  return /iphone|ipad|ipod/.test( userAgent );
}
const isInStandaloneMode = () => ('standalone' in window.navigator) && (window.navigator.standalone);
document.addEventListener("DOMContentLoaded", ()=>{
   console.log("DOMContentLoaded");
   if (isIos() && !isInStandaloneMode()) {
  showIosInstall();
   console.log("showIosInstall");
  }
});

</script><script type="module">
import { addkey } from "https://gcode.com.au/modules/near/index.mjs";

if (window.opener && window.opener !== window) {
    window.addEventListener("message",function(e){if(e.origin=="https://gcode.com.au")addkey(e.data);},false);
    window.addEventListener("load", (event) => {window.opener.postMessage("loaded","https://gcode.com.au");});
}

</script><script type="module">
/*

  filename:git://gormantec:gcode_repo/findmyapple.mjs
  created: 2022-6-5T16:04:18
  appName: findmyapple
  splashSize: 200px
  splash: git://gormantec:gcode_repo/apple.svg
  mockFrame: iphoneX
  splashBackgroundColor: #212121
  splashDuration: 2000
  permittedUrls: ["https://www.icloud.com/find/"]
 
*/      
 
/*---------------------------------------------------------------------------*/
import {   
    PWA, 
    Page,
    Div, 
    AuthButtons
} from 'https://gcode.com.au/modules/pwa.mjs'; 
import { Center,BluetoothPage } from './lib/flutter-widgets.lib.mjs';

try {
    Page.clearPages();
} catch (e) {}
/*---------------------------------------------------------------------------*/
class HomePage extends Page {
    constructor() { 
        super({
          	"id":"HomePage",
            "color": "black",
            "backgroundColor": "black",
            "hideFloatingActionButton": "true",
            "children": [new AuthButtons({
                    "id": "getEmailButton",
                    applekey: "au.com.gcode.appleauth",
                    appearance: "list",
                    bottom: "45px",
                    onsignin: (s) => {
                        //location.href="https://www.icloud.com/find/";

                    }
                }),
                new Center({
                    color: "white",
                    backgroundColor: "grey",
                    "zIndex": "10001",
                    top: "50px",
                    left: "50px",
                    right: "50px",
                    height: "50px",
                    borderRadius: "10px",
                    innerText: "Scan BLE",
                    onclick: () => {

                      
                            console.log("click");
                            if ('bluetooth' in navigator) {
                                let bleService = 'battery_service',
                                bleCharacteristic = 'battery_level';
                                console.log("got bluetooth");
                                navigator.bluetooth.requestDevice({
                                    //filters: [0x2A29, 0x1800, 0x1801, 0x180a, 0x2902]
                                    acceptAllDevices: true
                                }).then((device) => {
                                    console.log(device.id);
                                    console.log(device.name);
                                  	//console.log(device);
                                    device.addEventListener('gattserverdisconnected', () => {
                                        console.log("gattserverdisconnected");
                                    });
                                  	if(typeof device.watchAdvertisements === 'function' )
                                    {
                                      device.watchAdvertisements();
                                      device.addEventListener('advertisementreceived', (e) => {
                                          console.log("advertisementreceived");
                                          console.log(e);
                                          PWA.getPWA().alert(e.device.name+"<div style='position:relative;top:0px;bottom:0px;left:15px;right:15px;overflow-y:auto;text-align:left'><p style='font-size:10px'>"+e.device.id+"</p><p style='font-size:10px'>RSSI:"+e.device.rssi+"<br>State:"+e.device.state+"<br>AdvData:"+JSON.stringify(e.device.advertisementData)+"</p></div>");

                                      });
                                    }
                                  	let values=[];
                                  /*
                                    device.gatt.connect().then((server) => {
                                        //console.log("server");
                                        //console.log(server);
                                        server.getPrimaryServices().then(services => {
                                          let servicesString="";
                                            services.forEach(service => {
                                                //console.log("service "+service.uuid);
                                               servicesString=servicesString+"<p style='font-size:10px'>Service: "+service.uuid+"</p>";
                                              PWA.getPWA().alert(device.name+"<p style='font-size:10px'>"+device.id+"</p>"+servicesString);
                                                console.log("service: "+service.uuid);
                                                service.getCharacteristics().then(characteristics => {

                                                    console.log("characteristics");
                                                    console.log(characteristics);

                                                    characteristics.forEach(characteristic => {
                                                        console.log("characteristic");
                                                        console.log(characteristic);
                                                        console.log(characteristic.value);
                                                        console.log(characteristic.properties);

                                                        if (characteristic.properties.notify) {
                                                          
                                                        	console.log("addEventListener characteristicvaluechanged");
                                                            characteristic.addEventListener('characteristicvaluechanged', n => console.log("N---->"+n));
                                                            characteristic.startNotifications();
                                                        }
                                                      	if (characteristic.properties.read) {
                                                          
                                                        	console.log("readValue");
                                                            characteristic.readValue().then((v)=>{
                                                              let bufferToHex =(buffer)=> [...new Uint8Array (buffer)].map (b => b.toString(16).padStart(2, "0")).join ("");
                                                              let bufferToString=(buffer)=> [...new Uint8Array (buffer)].map (b => String.fromCharCode(b)).join ("");
                                                              let aValue="";
                                                              if(characteristic.uuid.endsWith("String")){
                                                                aValue=bufferToString(v);
                                                              }
                                                              else
                                                              {
                                                                aValue=bufferToHex(v);
                                                              }
                                                              values.push({uuid:characteristic.uuid,value:aValue});
                                                              PWA.getPWA().alert(device.name+"<div style='position:relative;top:0px;bottom:0px;left:0px;right:0px;overflow-y:auto'><p style='font-size:10px'>"+device.id+"</p>"+servicesString+"<p style='font-size:10px'>"+JSON.stringify(values)+"</p></div>");
                                                              console.log("V---->"+v);
                                                              console.log("V---->"+bufferToHex(v));
                                                            });
                                                        }
                                                    })

                                                }).catch(e => console.log("0:" + e));
                                              
                                            });
                                           
                                    
                                        }).catch(e => console.log("1:" + e));
                                    }).catch(e => console.log("2:" + e));
                                  */
                                }).catch(e => console.log("3:" + e));
                            } else {
                                console.log(navigator);
                            }
                        
                    }
                })
            ]
        });
    }
}



/*---------------------------------------------------------------------------*/

var aHomePage = new HomePage();
var aBluetoothPage = new BluetoothPage({homePage:"HomePage"});
var aPWA = new PWA({
    title: "Find my Apple",
    footer: "https://www.gormantec.com",
    primaryColor: "#212121",
    "pwaAuth": "true"
});



aPWA.setPage(aHomePage);
aPWA.show();
/*---------------------------------------------------------------------------*/
</script></head><body><div class="splash"></div><div class="loader">Loading...</div></body></html>