<!DOCTYPE html>
<html><head><link rel="manifest" href="/apps/37790665-gcode65x/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta property="fpwa:template" content="pwa=true,name=gcode65x,short_name=gcode65x,theme_color=#222222,background_color=#222222,display=standalone,orientation=any"><link rel="apple-touch-icon" href="/apps/37790665-gcode65x/icon.png"><link rel="apple-touch-icon-precomposed" href="/apps/37790665-gcode65x/icon.png"><link rel="icon" href="/apps/37790665-gcode65x/icon.png"><style>
.splash{position:absolute;background-size:200px;background-image:url(https://gcode.com.au/images/boatcrew/boat-logo.png);background-position:center;background-repeat:no-repeat;top:0px;bottom:0px;left:0px;right:0px;color:#AAAAAA;background-color:#222222;}
.loader{font-size:50px;text-indent:-9999em;overflow:hidden;width:1em;height:1em;border-radius:50%;margin:72px auto;position:absolute;bottom:20px;left:20px;right:20px;bottom:0;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:load6 1.7s infinite ease,round 1.7s infinite ease;animation:load6 1.7s infinite ease,round 1.7s infinite ease}@-webkit-keyframes load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}100%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}}@keyframes load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}100%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}}@-webkit-keyframes round{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes round{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}
</style><script>
  window.PWA={globals:{}};
  window.PWA.globals.appName="gcode65x";
  window.PWA.globals.orientation="any";
  window.PWA.globals.icon="https://gcode.com.au/images/boatcrew/boat-logo-blue.png";
  window.PWA.globals.icon180x180="https://gcode.com.au/images/boatcrew/boat-logo-blue.png";
  window.PWA.globals.icon192x192="https://gcode.com.au/images/boatcrew/boat-logo-blue-icon192x192.png";
  window.PWA.globals.icon512x512="https://gcode.com.au/images/boatcrew/boat-logo-blue-icon512x512.png";
  window.PWA.globals.splash="https://gcode.com.au/images/boatcrew/boat-logo.png";
  window.PWA.globals.splashColor="#AAAAAA";
  window.PWA.globals.mockFrame="iphoneX";
  window.PWA.globals.splashBackgroundColor="#222222";
  window.PWA.globals.splashDuration=2000;

  if('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/apps/37790665-gcode65x/sw.js');
};

function showIosInstall() {
  let iosPrompt = document.querySelector(".ios-prompt");
  iosPrompt.style.display = "block";
  iosPrompt.addEventListener("click", () => {
    iosPrompt.style.display = "none";
  });
}

const isIos = () => {
  const userAgent = window.navigator.userAgent.toLowerCase();
  return /iphone|ipad|ipod/.test( userAgent );
}
const isInStandaloneMode = () => ('standalone' in window.navigator) && (window.navigator.standalone);
document.addEventListener("DOMContentLoaded", ()=>{
   console.log("DOMContentLoaded");
   if (isIos() && !isInStandaloneMode()) {
  showIosInstall();
   console.log("showIosInstall");
  }
});

</script><script type="module">
import { addkey } from "https://gcode.com.au/modules/near/index.mjs";

if (window.opener && window.opener !== window) {
    window.addEventListener("message",function(e){if(e.origin=="https://gcode.com.au")addkey(e.data);},false);
    window.addEventListener("load", (event) => {window.opener.postMessage("loaded","https://gcode.com.au");});
}

</script><script type="module">
/*

  filename:gcode-ee051e8d604.mjs
  created: 2021-9-0T17:17:14
  appName: gcode65x
  splash: https://gcode.com.au/images/boatcrew/boat-logo.png
  icon: https://gcode.com.au/images/boatcrew/boat-logo-blue.png
  icon180x180: https://gcode.com.au/images/boatcrew/boat-logo-blue.png
  icon192x192: https://gcode.com.au/images/boatcrew/boat-logo-blue-icon192x192.png
  icon512x512: https://gcode.com.au/images/boatcrew/boat-logo-blue-icon512x512.png
  mockFrame: iphoneX
  splashBackgroundColor: #222222
  splashColor: #AAAAAA
  splashDuration: 2000
  splashSize: 200px

*/
/*---------------------------------------------------------------------------*/
//#1818ca
import {
    PWA,
    Page,
    Div,
    AuthButtons,
    ActionButton,
    DivForm
} from 'https://gcode.com.au/modules/pwa.mjs';
import {
    login,
    contract
} from 'https://gcode.com.au/modules/near/index.mjs';
try {
    Page.clearPages();
} catch (e) {}
/*---------------------------------------------------------------------------*/
class LoginPage extends Page {
    constructor() {
        super({
            "color": "#000000",
            "backgroundColor": "#2122d3",
            "backgroundPosition": "center",
            "backgroundSize": "cover",
            "backgroundRepeat": "no-repeat",
            "backgroundImage": "url(https://gcode.com.au/images/boatcrew/bg2664x.png)",
            "hideFloatingActionButton": "true",
            "hideFooter": "true",
            "child": loginButton,
            "bottom": ""
        });
    }

}
class ChatPage extends Page {
    constructor() {
        super({
            "color": "#000000",
            "backgroundColor": "#2122d3",
            "backgroundPosition": "center",
            "backgroundSize": "cover",
            "backgroundRepeat": "no-repeat",
            "backgroundImage": "url(https://gcode.com.au/images/boatcrew/bg2664x.png)",
            "navigateBackPage": aLoginPage,
            "child": myList
        });
    }
}
class CrewPage extends Page {
    constructor() {
        super({
            "color": "#000000",
            "backgroundColor": "#2122d3",
            "backgroundPosition": "center",
            "backgroundSize": "cover",
            "backgroundRepeat": "no-repeat",
            "hideFloatingActionButton": "true",
            "backgroundImage": "url(https://gcode.com.au/images/boatcrew/bg2664x.png)",
            "navigateBackPage": aChatPage
        });
    }
}
class SubmitPage extends Page {
    constructor() {
        super({
            "color": "#000000",
            "backgroundColor": "#2122d3",
            "backgroundPosition": "center",
            "backgroundSize": "cover",
            "backgroundRepeat": "no-repeat",
            "backgroundImage": "url(https://gcode.com.au/images/boatcrew/bg2664x.png)",
            "hideFloatingActionButton": "true",
            "navigateBackPage": aChatPage,
            "child": aSpinner
        });
    }
}
class FormPage extends Page {
    constructor() {
        super({
            "color": "#000000",
            "backgroundColor": "#ffffff",
            "navigateBackPage": aChatPage,
            "child": myDiv,
            "hideFloatingActionButton": "true",
        });
    }
}
/*---------------------------------------------------------------------------*/
let accountId = "";
let myList = new Div();
let messages = null;
let aSpinner = new Div({
    marginLeft: "50%",
    child: new Div({
        classNameOverride: "true",
        class: "loader",
        innerText: "...",
        "margin": "0px",
        "bottom": "40px",
        "right": "auto",
        "height": "40px",
        "width": "40px",
        "marginLeft": "-20px",
        "left": "auto",
        fontSize: "40px"
    })
})




var aChatPage = new ChatPage();
var aCrewPage = new CrewPage();
var aSubmitPage = new SubmitPage();
var loginButton = new AuthButtons({
    facebookkey: "1240916769304778",
    appearance: "list",
    nextPage: aChatPage
});
var sendButtonAction = function(e) {
    var subject = e.parentDiv.querySelector("#formSubject").innerText;
    var body = e.parentDiv.querySelector("#formBody").innerText;
    var driver = e.parentDiv.querySelector("#formDriver").value;
    var observer = e.parentDiv.querySelector("#formObserver").value;
    var date = e.parentDiv.querySelector("#formDate").value;
    var time = e.parentDiv.querySelector("#formTime").value;
    var seats = e.parentDiv.querySelector("#formSeats").value;
    var boat = e.parentDiv.querySelector("#formBoat").innerText;
    var location = e.parentDiv.querySelector("#formLocation").value;
    console.log(date);
    console.log(time);
    if (subject && subject.trim() != "" && body && body.trim() != "") {
        (async () => {
            var message = {
                "from": aPWA.credentials.name,
                "accountId": accountId,
                "subject": subject,
                "body": body,
                "driver": driver,
                "observer": observer,
                "boat": boat,
                "seats": seats,
                "location": location,
                "datetime": new Date(Date.parse(date + "T" + time + ":00")).toISOString()
            };
            console.log(message);
            aPWA.setPage(aSubmitPage);
            if (messages) await messages.addMessage({
                "message": JSON.stringify(message)
            });
            aPWA.setPage(aChatPage);
        })();
    }
};
var myDiv = new DivForm({
    paddingTop: "30px",
    formInputs: [{
            name: "subject",
            type: "text"
        },
        {
            name: "body",
            type: "text",
            height: "150px"
        },
        {
            name: "driver",
            type: "select",
            height: "40px",
            options: ["extra not needed", "extra required"]
        },
        {
            name: "observer",
            type: "select",
            height: "40px",
            options: ["extra not needed", "extra required"]
        },
        {
            name: "boat",
            type: "text"
        },
        {
            name: "location",
            type: "location",
            size: "40",
            country: ["au"]
        },
        {
            name: "seats",
            type: "number",
            min: "1",
            max: "14",
            value: "1"
        },
        {
            name: "date",
            type: "date"
        },
        {
            name: "time",
            type: "time",
            min: "5:00",
            max: "18:00",
            step: "900"
        }
    ],
    sendButton: {
        onclick: sendButtonAction
    }
});
var aLoginPage = new LoginPage();
var aFormPage = new FormPage();
var aPWA = new PWA({
    "title": "Boat Crew",
    "footer": "https://www.gormantec.com",
    "primaryColor": "#2122d3",
    "pwaAuth": "true"
});
aPWA.floatingActionButton.onclick(function() {
    aPWA.setPage(aFormPage);
});
aPWA.setPage(aLoginPage);
aPWA.show();
aPWA.addPageChangeListener((id) => {
    if (id == "ChatPage") {
        console.log("page=" + id);
        accountId = "gcode-4" + aPWA.userhash.toLowerCase() + ".testnet";
        //10160347981689434
        console.log(accountId);
        //lost contract = gcode-eea3047988c.testnet
        (async () => {
            try {
                if (!messages) {
                    var config = await login({
                        accountId: accountId,
                        contractId: "gcode-eeabe089d97.testnet"
                    });
                    config.methods = ["addMessage", "listMessages"];
                    messages = await contract(config);
                }

                try {
                    console.log(myList.firstChild.id);
                } catch (e) {}
                if (!myList.firstChild || !myList.firstChild.id || myList.firstChild.id != "spinnerRow") {
                    myList.insertBefore(new Div({
                        backgroundColor: "rgba(255, 255, 255, 0.7)",
                        id: "spinnerRow",
                        position: "relative",
                        height: "auto",
                        borderRadius: "10px",
                        padding: "20px",
                        margin: "10px",
                        child: new Div({
                            classNameOverride: "true",
                            class: "loader",
                            innerText: "...",
                            "margin": "14px",
                            "top": "0px",
                            "right": "0px",
                            "bottom": "0px",
                            "left": "0px",
                            fontSize: "14px"
                        })
                    }), myList.firstChild);
                }
                let accounts = [];
                accounts.push(accountId);
                let messageList = JSON.parse(await messages.listMessages({
                    accountIds: JSON.stringify(accounts),
                    max: 20
                }, 300000000000000));
                console.log(messageList);
                myList.removeChildren();
                for (var i = 0; i < messageList.data.length; i++) {
                    var dt = new Date(Date.parse(messageList.data[i].date));
                    console.log(dt.getHours() + ":" + dt.getMinutes().toString().padStart(2, "0"));
                    let localTime = dt.getHours() + ":" + dt.getMinutes().toString().padStart(2, "0");
                    let weekdays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
                    let localDay = weekdays[dt.getDay()];
                    let _message = messageList.data[i].message;
                    myList.appendChild(new Div({
                        class: "clickableDiv",
                        backgroundColor: "rgba(255, 255, 255, 0.7)",
                        position: "relative",
                        height: "auto",
                        borderRadius: "10px",
                        padding: "10px",
                        margin: "10px",
                        onclick: function() {
                            var html = "<h3>boat captain:" + _message.from + "</h3>" +
                                "<p><b>subject:</b> " + _message.subject + "</p>" +
                                "<p><b>body:</b> " + _message.body + "</p>" +
                                "<p><b>driver:</b> " + _message.driver + "</p>" +
                                "<p><b>observer:</b> " + _message.observer + "</p>" +
                                "<p><b>boat:</b> " + _message.boat + "</p>" +
                                "<p><b>location:</b> " + _message.location + "</p>" +
                                "<p><b>seats:</b> " + _message.seats + "</p>" +
                                "<p><b>datetime:</b> " + new Date(Date.parse(_message.datetime)).toLocaleString().substring(0, 17) + "</p>";

                          	let pageForm=new Div({
                                margin: "40px",
                                padding: "20px",
                                color: "#000000",
                                backgroundColor: "#ffffff",
                                borderColor: "#000000",
                                borderWidth: "2px",
                                borderStyle: "solid",
                                innerHTML: html
                            });
                          
                            pageForm.appendChild(new ActionButton({
                                left: "10%",
                                right: "10",
                                width: "80%",
                                innerText: "Ask to join",
                                position: "absolute",
                                margin: "auto",
                                bottom: "20px",
                                top: "unset",
                              	onclick: ()=>{console.log("ActionButton");}
                            }));
                            aCrewPage.setChild(pageForm);
                            aPWA.setPage(aCrewPage);
                        },
                        children: [
                            new Div({
                                position: "relative",
                                fontWeight: "bold",
                                innerHTML: messageList.data[i].message.subject
                            }),
                            new Div({
                                textAlign: "right",
                                fontSize: "small",
                                position: "absolute",
                                top: "10px",
                                right: "10px",
                                fontSize: "small",
                                innerHTML: localDay + " " + localTime
                            }),
                            new Div({
                                position: "relative",
                                fontSize: "small",
                                fontStyle: "italic",
                                marginTop: "10px",
                                innerHTML: "<p style=\"word-wrap: break-word;\">" + messageList.data[i].message.body + "</p>"
                            }),
                        ]
                    }));
                }
            } catch (e) {
                console.log(e);
            }

        })();
    }
});
/*---------------------------------------------------------------------------*/
</script></head><body><div class="splash"></div><div class="loader">Loading...</div></body></html>