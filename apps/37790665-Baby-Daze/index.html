<!DOCTYPE html>
<html><head><link rel="manifest" href="/apps/37790665-Baby-Daze/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="description" content="A gcode developed PWA app"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta property="fpwa:template" content="pwa=true,name=Baby Daze,short_name=Baby Daze,theme_color=#FA00AB,background_color=#FA00AB,display=standalone,orientation=any"><link rel="apple-touch-icon" href="/apps/37790665-Baby-Daze/icon.png"><link rel="apple-touch-icon-precomposed" href="/apps/37790665-Baby-Daze/icon.png"><link rel="icon" href="/apps/37790665-Baby-Daze/icon.png"><style>
.splash{position:absolute;background-size:300px;background-image:url('splash.icon.png');background-position:center;background-repeat:no-repeat;top:0px;bottom:0px;left:0px;right:0px;color:#F0F0F0;background-color:#FA00AB;}
.loader{font-size:50px;text-indent:-9999em;overflow:hidden;width:1em;height:1em;border-radius:50%;margin:72px auto;position:absolute;bottom:20px;left:20px;right:20px;bottom:0;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:load6 1.7s infinite ease,round 1.7s infinite ease;animation:load6 1.7s infinite ease,round 1.7s infinite ease}@-webkit-keyframes load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}100%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}}@keyframes load6{0%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}5%,95%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}10%,59%{box-shadow:0 -.83em 0 -.4em,-.087em -.825em 0 -.42em,-.173em -.812em 0 -.44em,-.256em -.789em 0 -.46em,-.297em -.775em 0 -.477em}20%{box-shadow:0 -.83em 0 -.4em,-.338em -.758em 0 -.42em,-.555em -.617em 0 -.44em,-.671em -.488em 0 -.46em,-.749em -.34em 0 -.477em}38%{box-shadow:0 -.83em 0 -.4em,-.377em -.74em 0 -.42em,-.645em -.522em 0 -.44em,-.775em -.297em 0 -.46em,-.82em -.09em 0 -.477em}100%{box-shadow:0 -.83em 0 -.4em,0 -.83em 0 -.42em,0 -.83em 0 -.44em,0 -.83em 0 -.46em,0 -.83em 0 -.477em}}@-webkit-keyframes round{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes round{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}
</style><script>
  window.PWA={globals:{}};
  window.PWA.globals.appName="Baby Daze";
  window.PWA.globals.orientation="any";
  window.PWA.globals.icon="icon.png";
  window.PWA.globals.icon180x180="180x180.icon.png";
  window.PWA.globals.icon192x192="192x192.icon.png";
  window.PWA.globals.icon512x512="512x512.icon.png";
  window.PWA.globals.splash="splash.png";
  window.PWA.globals.splashColor="#F0F0F0";
  window.PWA.globals.mockFrame="iphoneX";
  window.PWA.globals.splashBackgroundColor="#FA00AB";
  window.PWA.globals.splashDuration=2000;

let deferredPrompt;
if('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/apps/37790665-Baby-Daze/sw.js');
};

function addToHomeScreen() {
   let a2hsBtn = document.querySelector(".ad2hs-prompt");
   a2hsBtn.style.display = 'none'; 
   deferredPrompt.prompt();
   deferredPrompt.userChoice.then(function(choiceResult){
   if (choiceResult.outcome === 'accepted') console.log('User accepted the A2HS prompt');
   else console.log('User dismissed the A2HS prompt');
   deferredPrompt = null;
 });}
function showAddToHomeScreen() {
   let a2hsBtn = document.querySelector(".ad2hs-prompt");
   a2hsBtn.style.display ="block";
   a2hsBtn.addEventListener("click", addToHomeScreen);
 }
 window.addEventListener('beforeinstallprompt', function (e) {
   e.preventDefault();
   deferredPrompt = e;
   showAddToHomeScreen();
   setTimeout(()=>{document.querySelector(".ad2hs-prompt").style.display ="none";},10000);
 });
function showIosInstall() {
  let iosPrompt = document.querySelector(".ios-prompt");
  if(iosPrompt)iosPrompt.style.display = "block";
  if(iosPrompt)iosPrompt.addEventListener("click", () => {
  if(iosPrompt)iosPrompt.style.display = "none";
  });
}

const isIos = () => {
  const userAgent = window.navigator.userAgent.toLowerCase();
  return /iphone|ipad|ipod/.test( userAgent );
}
const isInStandaloneMode = () => ('standalone' in window.navigator) && (window.navigator.standalone);
document.addEventListener("DOMContentLoaded", ()=>{
   console.log("DOMContentLoaded");
   if (isIos() && !isInStandaloneMode()) {
  showIosInstall();
   console.log("showIosInstall");
  }
});

</script><script type="module">
import { addkey } from "https://gcode.com.au/modules/near/index.mjs";

if (window.opener && window.opener !== window) {
    window.addEventListener("message",function(e){if(e.origin=="https://gcode.com.au")addkey(e.data);},false);
    window.addEventListener("load", (event) => {window.opener.postMessage("loaded","https://gcode.com.au");});
}

</script><script type="module">
/*

  filename:git://gormantec:gcode_repo/BabyDaze.mjs
  created: 2022-6-5T16:37:51
  appName: Baby Daze
  splashSize: 300px
  splash: git://gormantec:gcode_repo/BabyDaze.svg
  mockFrame: iphoneX
  splashBackgroundColor: #FA00AB
  splashDuration: 2000
  includedImages: ["git://gormantec:gcode_repo/BabyDazeTitle400.png.svg"]

*/
// FA00AB

/*---------------------------------------------------------------------------*/
import {
    PWA,
    Page,
    Div
} from 'https://gcode.com.au/modules/pwa.mjs';
import {Text,Center,Container,ListView,ListTile,Icon,Icons,Video,Form,TextFormField,Padding,Column,VideoImage} from './lib/flutter-widgets.lib.mjs';
try {
    Page.clearPages();
} catch (e) {}

let listView=null;
let mediaStream=null;
let _blob=null;
let _iblob=null;
let mediaRecorder = null;
let facingMode="environment";
/*---------------------------------------------------------------------------*/
class HomePage extends Page {
    constructor() {
        super({
            "id": "HomePage",
            "color": "#545454",
            "backgroundColor": "#FAEBF2",
            "hideFloatingActionButton": "true",
            "hideFooter": "true",
            "child": new ListView({
                "id": "myListView",
                "padding": "8px",
                "children": [
                    new ListTile({
                        "color": "red",
                        "title": new Text("34 min ago"),
                        "subtitle": new Text("Nursing paused."),
                        "leading": new Icon(Icons.battery_full),
                        "trailing": new Icon(Icons.alarm),
                        "onclick": () => PWA.getPWA().setPage("NursingPaused")
                    }),
                    new ListTile({
                        "color": "blue",
                        "title": new Text("17 hours 34 min ago"),
                        "subtitle": new Text("Subtitle: The battery is full."),
                        "leading": new Icon(Icons.flag),
                        "trailing": new Icon(Icons.alarm),
                        "onclick": () => PWA.getPWA().setPage("SomeOtherPage1")
                    }),
                    new ListTile({
                        "color": "green",
                        "title": new Text("Sleep"),
                        "subtitle": new Text("Subtitle: The battery is full."),
                        "leading": new Icon(Icons.battery_full),
                        "trailing": new Icon(Icons.alarm),
                        "onclick": () => PWA.getPWA().setPage("SomeOtherPage2")
                    }),
                    new ListTile({
                        title: new Text("18 hours 20 min ago"),
                        subtitle: new Text("Subtitle: The battery is full."),
                        leading: new Icon(Icons.battery_full),
                        trailing: new Icon(Icons.star_outline),
                        onclick: () => PWA.getPWA().setPage("SomeOtherPage3")
                    }),
                    new ListTile({
                        color: "#2222FF",
                        title: new Text("17 hours 19 min ago"),
                        subtitle: new Text("Subtitle: The battery is full."),
                        leading: new Icon(Icons.battery_full),
                        trailing: new Icon(Icons.star_outline),
                        onclick: () => PWA.getPWA().setPage("SomeOtherPage4")
                    }),
                    new ListTile({
                        color: "#FF3333",
                        title: new Text("18 hours 20 min ago"),
                        subtitle: new Text("Video Blog"),
                        leading: new Icon(Icons.battery_full),
                        trailing: new Icon(Icons.star_outline),
                        onclick: () => PWA.getPWA().setPage("VideoBlog")
                    }),
                ],
            })

        });
    }

}

class NursingPaused extends Page {
    constructor(params) {
        super({
            "color": "#545454",
            "backgroundColor": "#FAEBF2",
            "hideFloatingActionButton": "true",
            "hideFooter": "true",
            "navigateBackPage": "HomePage",
            "padding": "15px",
            "id": params ? params.id : null,
            "child": new Text("Nursing Paused!")
        });
    }
}
class VideoBlog extends Page {
    constructor(params) {
        super({
            "id": "VideoBlog",
            "color": "#545454",
            "backgroundColor": "#FAEBF2",
            "hideFooter": "true",
            "navigateBackPage": "HomePage",
            "floatingActionButtonPage": "AddVideo",
            "onopen": () => {

                var indexedDB = window.indexedDB || window.webkitIndexedDB || window.mozIndexedDB || window.OIndexedDB || window.msIndexedDB;
                var dbVersion = 2.0;
                var request = indexedDB.open("babyVideos3", dbVersion);
                request.onerror = function(event) {
                    console.log("Error creating/accessing IndexedDB database");
                };
                request.onsuccess = function(event) {
                    var get = request.result.transaction(["videos"], "readonly").objectStore("videos").getAll();
                    get.onsuccess = function(event) {
                        console.log(event.target.result);
                        if (event.target.result && event.target.result.length > 0) {
                            listView.removeChildren();
                            for (let i = event.target.result.length - 1; i >= 0; i--) {

                                var b = new Blob([event.target.result[i].data], {
                                    type: 'video/' + event.target.result[i].type
                                });
                                var ib = new Blob([event.target.result[i].image], {
                                    type: 'image/jpeg'
                                });
                                let iobUrl = URL.createObjectURL(ib);
                                let timestamp = event.target.result[i].timestamp;
                                let obUrl = URL.createObjectURL(b);
                                let timeago = Math.floor((Date.now() - timestamp) / 610000);
                                let timeagoString = timeago + " minutes ago";
                                if (timeago > 60) timeagoString = Math.floor(timeago / 60) + " hours ago";
                                else if (timeago > 1440) timeagoString = Math.fooor(timeago / 1440) + " days ago";
                                else if (timeago > 43200) timeagoString = Math.fooor(timeago / 43200) + " months ago";
                                else if (timeago > 524160) timeagoString = Math.fooor(timeago / 524160) + " years ago";
                                let iii = i;
                                let width = 360;
                                let height = event.target.result[i].realheight * width / event.target.result[i].realwidth;
                                listView.appendChild(new Container({
                                    height: "240px",
                                    children: [
                                        new ListTile({
                                            color: "#545454",
                                            title: new Text(timeagoString),
                                            subtitle: new Text((event.target.result[i].comment || "")),
                                            leading: new Icon(Icons.battery_full),
                                            trailing: new Icon(Icons.star_outline)
                                        }), new Center({
                                            top: "40px",
                                            width: "360px",
                                            height: "202px",
                                            overflow: "hidden",
                                            children: [new Video({
                                                    width: width + "360px",
                                                    height: height + "px",
                                                    src: obUrl,
                                                    playsinline: "true",
                                                    display: "none",
                                                    id: "video-" + iii
                                                }),
                                                new VideoImage({
                                                    width: width + "px",
                                                    height: height + "px",
                                                    id: "videoCover-" + iii,
                                                    src: iobUrl,
                                                    onclick: () => {
                                                        let video = document.querySelector("#video-" + iii);
                                                        video.style.display = "";
                                                        document.querySelector("#videoCover-" + iii).style.display = "none";
                                                        video.currentTime = 0;
                                                        video.controls = true;
                                                        video.playsinline = true;
                                                        try {
                                                            video.play();
                                                        } catch (e) {
                                                            console.log(e);
                                                        }
                                                        const ev = () => {
                                                            let video2 = document.querySelector("#video-" + iii);
                                                            video2.style.display = "none";
                                                            document.querySelector("#videoCover-" + iii).style.display = "";
                                                            video2.currentTime = 0;
                                                            video2.removeEventListener('ended',ev);
                                                        };
                                                        video.addEventListener('ended', ev, false);
                                                    }
                                                })
                                            ]
                                        })
                                    ]
                                }));
                            }
                        }
                    };
                }
                request.onupgradeneeded = function(event) {
                    event.target.result.createObjectStore("videos");
                };

            }
        })
        listView = new ListView({
            "padding": "8px",
            "children": [
                new Container({
                    height: "240px",
                    children: [
                        new ListTile({
                            color: "#545454",
                            title: new Text("10 days ago"),
                            subtitle: new Text("Video of baby"),
                            leading: new Icon(Icons.battery_full),
                            trailing: new Icon(Icons.star_outline),
                            onclick: () => PWA.getPWA().setPage("VideoBlog")
                        }), new Center({
                            top: "40px",
                            height: "200px",
                            child: new Container({
                                width: "300px",
                                height: "200px",
                                backgroundColor: "black",
                                backgroundSize: "100% 100%",
                                backgroundImage: "url(https://images.pexels.com/photos/161709/newborn-baby-feet-basket-161709.jpeg?auto=compress&cs=tinysrgb&w=387&h=81&dpr=2)"
                            })
                        })
                    ]
                }), new Container({
                    height: "240px",
                    children: [
                        new ListTile({
                            color: "#545454",
                            title: new Text("11 days ago"),
                            subtitle: new Text("Video of baby"),
                            leading: new Icon(Icons.battery_full),
                            trailing: new Icon(Icons.star_outline),
                            onclick: () => PWA.getPWA().setPage("VideoBlog")
                        }), new Center({
                            top: "40px",
                            height: "200px",
                            child: new Container({
                                width: "300px",
                                height: "200px",
                                backgroundColor: "black",
                                backgroundSize: "100% 100%",
                                backgroundImage: "url(https://images.pexels.com/photos/161709/newborn-baby-feet-basket-161709.jpeg?auto=compress&cs=tinysrgb&w=387&h=81&dpr=2)"
                            })
                        })
                    ]
                }), new Container({
                    height: "240px",
                    children: [
                        new ListTile({
                            color: "#545454",
                            title: new Text("12 days ago"),
                            subtitle: new Text("Video of baby"),
                            leading: new Icon(Icons.battery_full),
                            trailing: new Icon(Icons.star_outline),
                            onclick: () => PWA.getPWA().setPage("VideoBlog")
                        }), new Center({
                            top: "40px",
                            height: "200px",
                            child: new Container({
                                width: "300px",
                                height: "200px",
                                backgroundColor: "black",
                                backgroundSize: "100% 100%",
                                backgroundImage: "url(https://images.pexels.com/photos/161709/newborn-baby-feet-basket-161709.jpeg?auto=compress&cs=tinysrgb&w=387&h=81&dpr=2)"
                            })
                        })
                    ]
                })
            ]
        });
        this.appendChild(listView);
    }
}
class SomeOtherPage extends Page {
    constructor(params) {
        super({
            "color": "#545454",
            "backgroundColor": "#FAEBF2",
            "hideFloatingActionButton": "true",
            "hideFooter": "true",
            "navigateBackPage": "HomePage",
            "padding": "15px",
            "id": params ? params.id : null,
            "child": new Text((params && params.id) ? params.id : "Some Other Page")
        });
    }
}
class AddVideo extends Page {
    constructor(params) {
        super({
            "color": "#545454",
            "backgroundColor": "#FAEBF2",
            "hideFloatingActionButton": "true",
            "hideFooter": "true",
            "navigateBackPage": "VideoBlog",
            "padding": "15px",
            "onopen": () => {
              	console.log("load page");
                document.querySelector('#video').style.display = "";
                document.querySelector('#videoCover').style.display = "none";
                document.querySelector('#saveButton').style.display = "none";
                let done = false;
              
                document.querySelector('#recButton').style.color = "grey";
                document.querySelector('#flipButton').style.color = "grey";
                if (mediaStream) {
                    mediaStream.getTracks().forEach(function(track) {
                        track.stop();
                    });
                    mediaStream = null;
                }
              	let getOrientation= ()=>window.innerWidth > window.innerHeight ? "landscape-primary" : "portrait-primary";
                var orientation = (screen.orientation || {}).type || screen.mozOrientation || screen.msOrientation || getOrientation();
                let videoSpecs = {
                    facingMode: "environment",
                    resizeMode: "crop-and-scale",
                    aspectRatio: 16 / 9
                }
                console.log(orientation);
                if (orientation === "portrait-secondary" || orientation === "portrait-primary") {
                    videoSpecs = {
                        facingMode: facingMode,
                        resizeMode: "crop-and-scale",
                        aspectRatio: 9 / 16
                    }
                }
              	console.log(videoSpecs);
                navigator.mediaDevices.getUserMedia({
                    audio: true,
                    video: videoSpecs
                }).then(function(aMediaStream) {
                    mediaStream = aMediaStream;
                    if (!done) {
                        const video = document.querySelector('video');
                        console.log(mediaStream);
                        console.log(mediaStream.getVideoTracks()[0].getSettings());
                        video.srcObject = mediaStream;
                        video.volume = 0.0;
                        video.muted = true;
                        video.playsinline = true;
                        video.autoplay = true;
                        video.onloadedmetadata = function(e) {
                            if (!done) {
                                video.play();
                                video.volume = 0.0;
                                video.muted = true;
                                video.playsinline = true;
                                video.autoplay = true;
                                done = true;
                                document.querySelector('#recButton').style.color = "black";
                                document.querySelector('#flipButton').style.color = "black";
                              	
                            }
                        }
                    }
                })

            },
            "id": params ? params.id : null,
            "children": [new Center({
                    height: "202px",
                    top: "10px",
                    child: new Center({
                        width: "360px",
                        height: "202px",
                        overflow: "hidden",
                        children: [new Video({
                            width: "360px",
                            height: "unset",
                            id: "video",
                            muted: "true",
                            playsinline: "true",
                            autoplay: "true"
                        }), new VideoImage({
                            width: "360px",
                            height: "202px",
                            id: "videoCover",
                            display: "none",
                          onclick: () => {
                            let video = document.querySelector("#video");
                            video.style.display = "";
                            document.querySelector("#videoCover").style.display = "none";
                            video.currentTime = 0;
                            video.controls = true;
                            video.playsinline = true;
                            try {
                              video.play();
                            } catch (e) {
                              console.log(e);
                            }
                            const ev2 = () => {
                              let video2 = document.querySelector("#video");
                              video2.style.display = "none";
                              document.querySelector("#videoCover").style.display = "";
                              video2.currentTime = 0;
                              video2.removeEventListener('ended',ev2);
                            };
                            video.addEventListener('ended', ev2, false);
                          }
                        })]
                    })
                }),
                new Form({
                    top: "230px",
                    left: "20px",
                    right: "20px",
                    fontSize: "12px",
                    children: [
                        new TextFormField({
                            fontSize: "12px",
                            id: "dateTextFormField"
                        }),
                        new TextFormField({
                            fontSize: "12px",
                            id: "commentTextFormField"
                        }),
                    ]
                }),

                new Center({
                    height: "50px",
                    bottom: "25px",
                    width: "60px",
                    left: "20px",
                    child: new Div({
                        id: "flipButton",
                        width: "30px",
                        height: "30px",
                        fontSize: "30px",
                        color: "grey",
                        child: new Icon("flip_camera_ios")}),
                        onclick: () => {
                          if(facingMode=="environment")facingMode="user";
                          else facingMode="environment";
                          console.log("click");
                          PWA.refeshCurrentPage();
                        }
                }),

                new Center({
                    height: "50px",
                    bottom: "25px",
                  	left:"80px",
                  	right:"80px",
                    child: new Div({
                        id: "recButton",
                        width: "50px",
                        height: "50px",
                        fontSize: "50px",
                        color: "black",
                        child: new Icon("radio_button_checked"),
                        onclick: () => {
                            let aTimeout = null;
                            if (document.querySelector('#recButton').style.color == "black") {
                                document.querySelector('#video').style.display = "";
                                document.querySelector('#videoCover').style.display = "none";
                                document.querySelector('#recButton').style.color = "red";
                                const video = document.querySelector('video');
                                if (!video.srcObject && mediaStream) {
                                    video.src = null;
                                    video.srcObject = mediaStream;
                                    video.autoplay = true;
                                }
                                video.removeAttribute("controls");
                                video.setAttribute("muted", "muted");
                                video.volume = 0.0;
                                video.muted = true;

                                mediaRecorder = new MediaRecorder(mediaStream);
                                mediaRecorder.start(1000);
                                let chunks = [];
                                mediaRecorder.ondataavailable = function(e) {
                                    chunks.push(e.data);
                                }
                                mediaRecorder.onstop = function(e) {
                                    console.log(mediaRecorder);
                                    console.log("stopped");
                                    if (mediaRecorder.mimeType == "video/mp4") {
                                        _blob = new Blob(chunks, {
                                            'type': 'video/mp4'
                                        });
                                    } else {
                                        _blob = new Blob(chunks, {
                                            'type': 'video/webm'
                                        });
                                    }
                                    video.srcObject = null;

                                    Video.getVideoCover(_blob, 1.5).then(({
                                        width,
                                        height,
                                        blob
                                    }) => {
                                        document.querySelector('#video').style.display = "none";
                                        document.querySelector('#videoCover').style.display = "";
                                        videoCover.src = URL.createObjectURL(blob);
                                        _iblob = blob;
                                        videoCover.style.height = height * parseInt(videoCover.style.width) / width + "px";
                                        videoCover.dataset.realwidth = width;
                                        videoCover.dataset.realheight = height;
                                    });

                                    let b = URL.createObjectURL(_blob);
                                    video.volume = 0.2;
                                    video.muted = false;
                                    video.playsinline = true;
                                    video.autoplay = false;
                                    video.src = b;
                                    video.pause();
                                    video.setAttribute("controls", "controls");
                                    video.removeAttribute("muted");
                                  	mediaRecorder=null;
                                }
                                aTimeout = setTimeout(() => {
                                    aTimeout = null;
                                    console.log("stop");
                                    let dt = Date.now();
                                    let d = new Date(dt);
                                    if(mediaRecorder)mediaRecorder.stop();
                                    document.querySelector('#recButton').style.color = "black";
                                    document.querySelector('#saveButton').style.display = "";
                                    document.querySelector('#dateTextFormField').innerText = d.toLocaleString();
                                    document.querySelector('#dateTextFormField').dataset.timestamp = dt;

                                }, 10000);
                            } else if (document.querySelector('#recButton').style.color == "red") {
                                if (aTimeout) clearTimeout(aTimeout);
                                console.log("stop");
                                let dt = Date.now();
                                let d = new Date(dt);
                                if(mediaRecorder){
                                  console.log("stopping");
                                  mediaRecorder.stop();
                                }
                                document.querySelector('#recButton').style.color = "black";
                                document.querySelector('#saveButton').style.display = "";
                                document.querySelector('#dateTextFormField').innerText = d.toLocaleString();
                                document.querySelector('#dateTextFormField').dataset.timestamp = dt;
                            }
                        }

                    })
                }),
                new Center({
                    height: "50px",
                    bottom: "25px",
                    width: "60px",
                    right: "20px",
                    child: new Div({
                        id: "saveButton",
                        width: "40px",
                        height: "40px",
                        fontSize: "40px",
                        color: "black",
                        display: "none",
                        child: new Icon("save"),
                        onclick: () => {
                            // Request persistent storage for site
                            if (navigator.storage && navigator.storage.persist) {
                                navigator.storage.persist().then((isPersisted) => {
                                    var indexedDB = window.indexedDB || window.webkitIndexedDB || window.mozIndexedDB || window.OIndexedDB || window.msIndexedDB;
                                    var dbVersion = 2.0;
                                    var request = indexedDB.open("babyVideos3", dbVersion),
                                        db;
                                    request.onerror = function(event) {
                                        console.log("Error creating/accessing IndexedDB database");
                                    };
                                    request.onsuccess = function(event) {
                                        let type = "webm";
                                        if (_blob.type == "video/mp4") type = "mp4"
                                        var videoName = "video-" + document.querySelector('#dateTextFormField').dataset.timestamp + "." + type;
                                        console.log(_blob);
                                        new Response(_iblob).arrayBuffer().then((imageArrayBuffer) => {
                                            new Response(_blob).arrayBuffer().then((arrayBuffer) => {
                                                console.log(arrayBuffer);
                                                let obj = {
                                                    name: videoName,
                                                    type: type,
                                                    time: document.querySelector('#dateTextFormField').innerText,
                                                    timestamp: document.querySelector('#dateTextFormField').dataset.timestamp,
                                                    comment: document.querySelector('#commentTextFormField').innerText,
                                                    image: imageArrayBuffer,
                                                    realwidth: document.querySelector('#videoCover').dataset.realwidth,
                                                    realheight: document.querySelector('#videoCover').dataset.realheight,
                                                    data: arrayBuffer
                                                };
                                                console.log(obj);
                                                var put = request.result.transaction(["videos"], "readwrite").objectStore("videos").put(obj, videoName);
                                                document.querySelector('#saveButton').style.display = "none";
                                                PWA.refeshCurrentPage();
                                            });
                                        });
                                    }
                                    request.onupgradeneeded = function(event) {
                                        event.target.result.createObjectStore("videos");
                                    };
                                });
                            }
                        }
                    })
                }),
            ]
        });
    }
}

/*---------------------------------------------------------------------------*/
var myDiv = new Div({
    innerHTML: "url(https://gcode.com.au/html/test.html)"
});
var aHomePage = new HomePage();
var aAddVideo = new AddVideo();
var aVideoBlog = new VideoBlog({
    id: "VideoBlog"
});
var aNursingPaused = new NursingPaused({
    id: "NursingPaused"
});
var aSomeOtherPage1 = new SomeOtherPage({
    id: "SomeOtherPage1"
});
var aSomeOtherPage2 = new SomeOtherPage({
    id: "SomeOtherPage2"
});
var aSomeOtherPage3 = new SomeOtherPage({
    id: "SomeOtherPage3"
});
var aSomeOtherPage4 = new SomeOtherPage({
    id: "SomeOtherPage4"
});
var aSomeOtherPage5 = new SomeOtherPage({
    id: "SomeOtherPage5"
});
var aPWA = new PWA({
    title: "Baby Daze",
    titleBackgroundColor: "rgb(250,0,171,0.3)",
    headerHeight: "180px",
    headerBackgroundImage: "url(https://images.pexels.com/photos/161709/newborn-baby-feet-basket-161709.jpeg?auto=compress&cs=tinysrgb&w=387&h=81&dpr=2)",
    primaryColor: "#FA00AB",
});
aPWA.setPage(aHomePage);
aPWA.show();
/*---------------------------------------------------------------------------*/
</script></head><body><div class="splash"></div><div class="loader">Loading...</div></body></html>